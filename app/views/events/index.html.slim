.row-fluid
  .box.span12
    .box-header
      h2
        i.icon-user
        span.break
        = "Users"
    .box-content
      .row-fluid
        .pull-right
          = link_to 'Create New Event', new_event_path, {remote: true, class: 'btn btn-primary'}

      .row-fluid
        .span8
          .pull-right
            #toggle-events-view.btn-group
              a.btn.active href="#list-view" data-toggle="tab" List
              a.btn href="#map-view" data-toggle="tab" Map
          .clearfix
          .tab-content
            #list-view.tab-pane.active
              table#events-list.table.table-striped.table-bordered.table-scrolled
                thead
                  tr
                    th Start Date
                    th Start Time
                    th Location
                    th Campaign
                    th Status
                    th
                tbody
            #map-view.tab-pane
              #map-canvas
        .box-content.span4
          #events-list-filters
            #dates-range-filter
            = form_tag('#', id: 'event-filters-form',method: :get) do
              = hidden_field_tag 'by_period[start_date]'
              = hidden_field_tag 'by_period[end_date]'

javascript:
  var eventsTable = $('#events-list').dataTable({
        "sDom": "<'row-fluid'<'span6'l><'span6'f>r><'scroll-table-wrapper't>",
        "bPaginate": false,
        "bProcessing": true,
        "bServerSide": false,
        "sAjaxSource": "#{events_path(format: :table)}",
        "fnServerParams": function (aoData) {
          data = $("#event-filters-form").serializeArray();
          $.each(data, function(index, value){
            aoData.push(value);
          });
        },
        "aoColumns": [
          null,
          null,
          null,
          null,
          null,
          {"sWidth": '50px', 'bSortable': false}
        ],
  })

  $('#dates-range-filter').datepick({
    rangeSelect: true,
    monthsToShow: 2,
    changeMonth: false,
    onSelect: function(dates) {
      var start_date = (dates[0].getMonth() + 1) + "/" + dates[0].getDate() + "/" + dates[0].getFullYear();
      $('#by_period_start_date').val(start_date);

      $('#by_period_end_date').val('');
      if (dates[0] != dates[1]) {
        var end_date = (dates[1].getMonth() + 1) + "/" + dates[1].getDate() + "/" + dates[1].getFullYear();
        $('#by_period_end_date').val(end_date);
      }

      eventsTable.fnReloadAjax();
    }
  });

  var map;
  function initializeMap() {
    var mapOptions = {
      center: new google.maps.LatLng(-34.397, 150.644),
      zoom: 13,
      mapTypeId: google.maps.MapTypeId.ROADMAP
    };
    map = new google.maps.Map(document.getElementById('map-canvas'),
        mapOptions);
  }

  $('#toggle-events-view a').click(function(){
    $('#toggle-events-view a').removeClass('active');
    $(this).addClass('active').tab('show');
    if ($(this).attr('href')=='#map-view' && !map){
      initializeMap()
    }
  })

