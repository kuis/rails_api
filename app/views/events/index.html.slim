.row-fluid
  .box.span12
    .row-fluid
      #resource-index-container.span12
        .pull-right
          #resource-filter-column data-spy="affix" data-offset-top="0"
            = link_to 'Create New Event', new_event_path, {remote: true, class: 'btn btn-primary'}
            #events-list-filters

        .text-right
          #toggle-events-view.btn-group
            a.btn.active href="#list-view" data-toggle="tab" title="List View" List
            a.btn href="#map-view" data-toggle="tab" title="Map View" Map

        .tab-content
          #list-view.tab-pane.active
            #events-filter-label
            table#events-list.table.table-striped.table-bordered.table-scrolled
              thead
                tr
                  th Start Date
                  th Start Time
                  th Location
                  th Campaign
                  th Status
                  th
              tbody

          #map-view.tab-pane
            #map-canvas.google-map


javascript:
  $('#events-list-filters').filterBox({
    'onChange': function(filterBox){
      eventsTable.fnReloadAjax();
    }
  });


  var fixedTable = false;
  var eventsTable = $('#events-list').dataTable({
        "sDom": "<'row-fluid'<'span6'l>r>t",
        "bPaginate": false,
        "bProcessing": true,
        "bAutoWidth":false,
        "bServerSide": false,
        "sAjaxSource": "#{events_path(format: :json)}",
        "fnServerParams": function (aoData) {
          data = $('#events-list-filters').filterBox('getFilters');
          $.each(data, function(index, value){
            aoData.push(value);
          });
        },
        "fnServerData": function ( sSource, aoData, fnCallback ){
          $.getJSON(sSource, aoData, function (json){
              data = $.map(json, function(event, index){
                var actionButtons = $('<div>')
                    .append($('<a>', {'href': event.links.edit,'title':'Edit', 'data-remote': true}).text('Edit'))
                    .append(' ');
                if (event.active){
                    actionButtons.append($('<a>', {'href': event.links.deactivate, 'title':'Deactivate', 'data-remote': true}).text('Deactivate'))
                } else{
                    actionButtons.append($('<a>', {'href': event.links.activate, 'title':'Activate', 'data-remote': true}).text('Activate'))
                }
                return [[
                    $('<div>').append($('<a>',{'href': event.links.show, 'title':'View Event'}).text(event.start_date)).html(),
                    $('<div>').append($('<a>',{'href': event.links.show, 'title':'View Event'}).text(event.start_time)).html(),
                    (event.place ? $('<div>').append($('<a>',{'href': event.links.show, 'title':'View Event'}).text(event.place.name)).html() : '' ),
                    (event.campaign ? $('<div>').append($('<a>',{'href': event.links.show, 'title':'View Event'}).text(event.campaign.name)).html() : '' ),
                    $('<div>').append($('<a>',{'href': event.links.show, 'title':'View Event'}).text(event.status)).html(),
                    actionButtons.html()
                  ]];
              });
              fnCallback({aaData: data});
              $('#events-filter-label').html(data.length + " events " + $('#events-list-filters').filterBox('describeFilters'))

              $(document).trigger('events-list:changed',[json]);
              if (!fixedTable){
                fixedTable = new FixedHeader( eventsTable, {
                    "offsetTop": 90
                });
              }
          });
        },
        "aoColumns": [
          {"sWidth": '100px'},
          {"sWidth": '100px'},
          null,
          null,
          {"sWidth": '70px'},
          {"sWidth": '100px', 'bSortable': false}
        ],
  })






