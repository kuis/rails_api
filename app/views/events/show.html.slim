- can_edit = can?(:update, resource)
- can_tasks = can?(:tasks, resource)

- if resource.approved?
  = user_new_feature('event_details_approved') do
    h5 Getting Started: Event Details
    a.close.btn-dismiss-alert.icon.icon-close href="#" title="Dismiss"
    a.video-thumbnail href="#" title="Play Video" data-video="//www.youtube.com/embed/plxyWGK0LCU?rel=0" data-width="640" data-height="360"
      img src="#{image_path('video_arrow.png')}" width="70" height="70" /
    .feature-description
      p
        'You are viewing the Event Details page for an executed event. Scroll down the page to view post event data, check out pictures and review comments. Click on the video to the left for a quick overview or visit our
        a> href="http://support.brandscopic.com" target="_blank" support site
        | for more information about this section.
- else
  = user_new_feature('event_details_scheduled') do
    h5 Getting Started: Event Details
    a.close.btn-dismiss-alert.icon.icon-close href="#" title="Dismiss"
    a.video-thumbnail href="#" title="Play Video" data-video="//www.youtube.com/embed/IFqNZ4r14Uo?rel=0" data-width="640" data-height="360"
      img src="#{image_path('video_arrow.png')}" width="70" height="70" /
    .feature-description
      p
        'Welcome to the Event Details page. On this page you can edit event information, fill out Post Event data, as well as submit, approve, or reject reports. Click on the video to the left for a quick overview or visit our
        a> href="http://support.brandscopic.com" target="_blank" support site
        | for more information about this section.

.row-fluid.with-details-close-bar 
  = render 'details_bar'
  div
    #event-info.details_box class="#{(resource.place.nil? or resource.place.latitude.nil?) ?  'padding-top-close-bar' : ''}"

      .phases-top-nav
        h5.pull-left = 'EVENT PHASES:'
        span.step.completed
          span.circle-step
            i.icon-checked
          | PLAN

        span.step.active
          span.circle-step
            | 2
          | EXECUTE

        span.step
          span.circle-step
            | 3
          | RESULTS


      .row-fluid.details_first_container
        .span6
          .details-title
            h2.special.pull-left
              b= resource.campaign_name
            .edition-links
              = button_to_edit resource if can_edit
              = button_to_activate_or_deactivate(resource) if can?(:deactivate, resource)

          .calendar-data
            i.icon-calendar
            span
              = format_date_range(event_date(resource, :start_at), event_date(resource, :end_at))
          - unless resource.place.nil?
            .place-data
              i.icon-wired-venue
              span
                = place_address(resource.place, true, ', ') if resource.place

          - unless resource.description.nil? || resource.description.empty?
            .description-data
              span= simple_format resource.description

          - if can?(:view_members, resource)
            - unless resource.users.empty? && resource.teams.empty?
              #event-team-members.add-details-info
                i.icon-team.indicate-icon
                = presenter.team_members

        .span6.map_container
          - unless resource.place.nil? || resource.place.latitude.nil? || resource.place.latitude == 1.0
            #venue-map-canvas.google-map data-latitude="#{resource.place.latitude}" data-longitude="#{resource.place.longitude}"
                b= resource.campaign_name
                br>/
                = event_date(resource, :start_at).to_s
                br>/
                = place_address(resource.place)
    #event-details-info-end


    - if can?(:view_contacts, resource)
      #event-contacts.details_box
        h5.module-title id="mdo" CONTACTS
        #event-contacts-list
          = render 'contacts'

    #event-approve_per
    - resource.results.each { |r| r.errors.clear }
    - if resource.event_data? && !resource.rejected?
      = render 'show_results'
    - elsif resource.happens_today? || resource.in_past?
      = render 'edit_results'

    - if can_tasks
      #event-tasks.details_box
        = render partial: 'tasks', locals: { tasks: resource.tasks.active }

    - if can? :documents, resource
      #event-documents.details_box
        h5.module-title DOCUMENTS
        - hidden = resource.documents.active.any? || resource.campaign.documents.any?
        = render partial: 'attached_assets/document_form', locals: { hidden: hidden, resource: AttachedAsset.new, callback_url: event_documents_path(resource, format: :js) }
        = link_to 'Upload', '#documents_upload_form', 'data-toggle' => 'collapse', id: 'event-upload-documents', class: "btn btn-primary #{hidden ? '' : 'hide'}", title: 'Add Documents' if can? :create_document, Event
        .documents-list
          #documents-list.resource-list
            = render :partial => "documents/document", :collection => resource.documents.active + resource.campaign.documents, :locals => { parent: resource }

  = render partial: 'help_tutorial'
  - if can_tasks
    javascript:
      if (#{can_tasks}){
        $(document).on('tasks:change task:deactivated', function(){
          $.get('#{tasks_event_path(resource)}', function(response){
            $response = $('<div>').append(response);
            $('#event-tasks').html($response.find('[data-content="tasks"]').html());
          })
        });
      }

  javascript:
    $(document).ready(function() {
      $(window).bind('scroll', function() {
        console.log($(window).scrollTop() + $('header').outerHeight() + ' > ' + $('header').outerHeight())
        if (($(window).scrollTop() + $('header').outerHeight()) >  $('header').outerHeight()) {
          $('.details-bar').addClass('fixed');
        }
        else {
          $('.details-bar').removeClass('fixed');
        }
      });
    });
  - reload_page_on_edit_resource
