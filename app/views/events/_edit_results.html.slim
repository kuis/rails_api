#event-results-form
  = simple_form_for(resource, url: save_results_event_path(resource), remote: true) do |f|
    = render partial: 'result_fields', locals: {fields: resource.campaign.form_fields.includes(:kpi), f: f}

    = f.submit "Save Results", id: 'save-event-results', class: 'btn btn-primary', disable_with: 'Please wait...'

javascript:
  $('#save-event-results').click(function(){
    $('form#edit_event_#{resource.id}').submit();
  })
  $('.segment-field').keyup(function(e){
    total = 0;
    $.map($('[data-segment-field-id="'+$(this).data('segment-field-id')+'"].segment-field'), function(element, index){
      if ( $(element).val().match(/^[0-9]+$/) ){
        total += parseInt($(element).val())
      }
    });
    $('#progress-bar-field-'+ $(this).data('segment-field-id')).data('total',total).progressbar( "value", total );
  })
  $('.percentage-progress-bar').progressbar({
      change: function(event, ui) {
        $(this).find('label').text( $(this).data( "total" ) + "%" );
      }
  });
  $('.segment-field').keyup();  