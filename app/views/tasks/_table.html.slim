.pull-left
  = button_to 'Create', new_task_path, {method: :get, remote: true, class: 'btn btn-primary', :id => 'new-task-btn'} if (params[:scope] == 'user' && can?(:create_my, Task)) || (params[:scope] == 'teams' && can?(:create_team, Task))
.tasks-progress-bar
.link-list.rows-no-list
  ul#tasks-list

javascript:
  $('#collection-list-filters').filteredList({
    'source': '#{source}',
    'filtersUrl': '#{url_for(action: :filters)}',
    'listContainer' : '#tasks-list',
    'sorting': 'due_at',
    'sorting_dir': 'asc',
    'includeCalendars': true,
    'calendarHighlights': #{calendar_highlights.to_json.html_safe},
    'selectDefaultDate': false,
    'includeSearchBox': false,
    'includeAutoComplete': true,
    'autoCompletePath': '#{autocomplete_events_path(format: :json)}',
    'defaultParams': [{name: 'status[]', value: 'Active'}],
    'onItemsLoad': function(response, page){
      if (response.find('div[data-content="counters"]').length > 0){
        $('.tasks-progress-bar').html(response.find('div[data-content="counters"]'))
      }
    },
    'onItemsChange': function(response, page){
      var taskId = document.location.hash.replace(/^#comments\-([0-9]+)/, '$1');
      if (taskId){
        $('li#task_'+taskId+' .load-comments-link').click()
      }
    }
  });
