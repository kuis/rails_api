- content_for :alerts
  div class="alert collection-list-description"
    a.close data-dismiss="alert"
    .filter-label

= render_navigation(renderer: :bootstrap, level: 2, skip_if_empty: true, nav_class: 'nav-tabs')
.sidebar#resource-filter-column
  #collection-list-filters
  #save-filters-btn.a.btn.btn-primary Save

.main
  .tab-content
    #list-view.tab-pane.active
      #list-tools.row-fluid
        .pull-right
          a.btn.download id="download-photos-button" href="" title="Download"
          #download-photos-counter-container
      .photo-list
        ul.thumbnails id="#{controller_name}-list"

= render partial: 'help_tutorial'

javascript:
  $('#collection-list-filters').filteredList({
    'source': '#{items_path(controller: 'results/photos')}',
    'filtersUrl': '#{filters_path(controller: 'results/photos')}',
    'listContainer': '##{controller_name}-list',
    'sorting': 'created_at',
    'sorting_dir': 'desc',
    'autoLoad': true,
    'includeCalendars': true,
    'selectDefaultDate': false,
    'includeSearchBox': false,
    'includeAutoComplete': true,
    'autoCompletePath': '#{url_for(controller: 'results/photos', action: :autocomplete, format: :json)}',
    'defaultParams': [{name: 'status[]', value: 'Active'}],
    'onItemsLoad': function(response, page){
      if (response.find('div[data-content="filters-description"]').length > 0){
        $('.collection-list-description .filter-label').html(response.find('div[data-content="filters-description"]'))
      }
    }
  });

  $(document).delegate('.photo-download-link', 'click', function(e) {
    e.preventDefault();
    target = $(this).closest('li.photo-item');
    target.toggleClass('selected-for-download');
    target_id = target.data('photo-id');

    if (target.is('.selected-for-download')) {
      $(this).removeClass('icon-plus').addClass('icon-minus');
    } else {
      $(this).removeClass('icon-minus').addClass('icon-plus');
    }
    selected_elements = $('.selected-for-download').length;
    counter_html = ''
    if (selected_elements > 0) {
      counter_html = '<span class="badge download-photos-counter">' + selected_elements + '</span>';
    }
    $('#download-photos-counter-container').html(counter_html);

    return false;
  });

  $(document).delegate('#download-photos-button', 'click', function(e) {
    e.preventDefault();
    ids  = $.map($('.selected-for-download'), function(photo, index){
      return photo.getAttribute('data-photo-id');
    })
    $.post('#{downloads_results_photos_url(format: :js)}', {photos: ids})
  });