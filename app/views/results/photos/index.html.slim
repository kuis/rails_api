- content_for :alerts
  div class="alert collection-list-description"
    a.close data-dismiss="alert"
    .filter-label

= user_new_feature('results_photos') do
  h5 Getting Started: Photos Report
  a.close.btn-dismiss-alert href="#" title="Dismiss"
  a.video-thumbnail href="#" title="Play Video" data-video="//www.youtube.com/embed/qDh7f0KYCRo?rel=0" data-width="640" data-height="360"
    img src="/assets/video_arrow.png" /
  .feature-description
    p
      'Want to see what happened at your event? Scroll though the pictures below or use the right sidebar filter to target specific campaigns and events. Click on the video to the left for a quick overview or check out our
      a> href="http://support.brandscopic.com" target="_blank" support site
      | for more in depth info.

.sidebar#resource-filter-column
  #collection-list-filters
  #save-filters-btn.a.btn.btn-primary Save

.main.with-details-close-bar
  = resource_details_bar("You are viewing Photos report. Click to close.")
  .tab-content
    #list-view.tab-pane.active
      #list-tools.row-fluid
        .pull-right
          a.btn.download id="download-photos-button" href="" title="Download"
          #download-photos-counter-container
      .gallery
        ul id="#{controller_name}-list"

= render partial: 'help_tutorial'

javascript:
  $('#collection-list-filters').filteredList({
    'source': '#{items_path(controller: 'results/photos')}',
    'filtersUrl': '#{filters_path(controller: 'results/photos')}',
    'listContainer': '##{controller_name}-list',
    'sorting': 'created_at',
    'sorting_dir': 'desc',
    'autoLoad': true,
    'includeCalendars': true,
    'selectDefaultDate': false,
    'includeSearchBox': false,
    'includeAutoComplete': true,
    'autoCompletePath': '#{url_for(controller: 'results/photos', action: :autocomplete, format: :json)}',
    'defaultParams': [{name: 'status[]', value: 'Active'}],
    'onItemsLoad': function(response, page){
      if (response.find('div[data-content="filters-description"]').length > 0){
        $('.collection-list-description .filter-label').html(response.find('div[data-content="filters-description"]'))
      }
    }
  });

  $(document).delegate('#photo-download-add', 'click', function(e) {
    e.preventDefault();
    target = $(this).closest('li.photo-item');
    target.toggleClass('selected-for-download');
    target_id = target.data('photo-id');

    if (target.is('.selected-for-download')) {
      $(this).removeClass('icon-plus').addClass('icon-minus');
    } else {
      $(this).removeClass('icon-minus').addClass('icon-plus');
    }
    selected_elements = $('.selected-for-download').length;
    counter_html = ''
    if (selected_elements > 0) {
      counter_html = '<span class="badge download-photos-counter">' + selected_elements + '</span>';
    }
    $('#download-photos-counter-container').html(counter_html);

    return false;
  });

  $(document).delegate('#download-photos-button', 'click', function(e) {
    e.preventDefault();
    ids  = $.map($('.selected-for-download'), function(photo, index){
      return photo.getAttribute('data-photo-id');
    })
    if (ids.length > 0) {
      $.post('#{downloads_results_photos_url(format: :js)}', {photos: ids})
    } else {
      bootbox.alert('Please select at least one photo to download');
    }
  });